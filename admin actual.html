<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aspire Trade - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --darker: #111827;
            --light: #f3f4f6;
            --gray: #6b7280;
            --bg: #0b0f19;
            --card1: rgba(20,26,48,.72);
            --card2: rgba(15,19,34,.86);
            --muted: #8d95af;
            --text: #e9ecf5;
            --good: #27e0a1;
            --bad: #ff5c7a;
            --accent: #5aa6ff;
            --accent2: #7b5bff;
            --border: rgba(255,255,255,.06);
            --shadow: 0 10px 30px rgba(0,0,0,.35);
            --radius: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: 
                radial-gradient(1200px 600px at 50% -10%, rgba(90,166,255,.08), transparent 60%),
                var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: linear-gradient(180deg, var(--card1), var(--card2));
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: var(--shadow);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.05);
        }

        .status-online {
            color: var(--secondary);
        }

        .status-offline {
            color: var(--danger);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .online-dot {
            background: var(--secondary);
        }

        .offline-dot {
            background: var(--danger);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .admin-badge {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--gray), #4b5563);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--secondary), #059669);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            padding: 12px 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Dashboard Grid */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: linear-gradient(180deg, var(--card1), var(--card2));
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .card:hover {
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .card h2 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2 i {
            color: var(--primary);
        }

        /* Signal Card - –°—Ç–∏–ª–∏ –∏–∑ trading.html */
        .signal-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        .signal-compact {
            text-align: center;
        }

        .signal-pair {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .signal-direction {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .signal-buy {
            color: var(--good);
        }

        .signal-sell {
            color: var(--bad);
        }

        .signal-hold {
            color: var(--warning);
        }

        .signal-details-compact {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .signal-detail-compact {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--muted);
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 1rem;
            font-weight: bold;
            color: var(--text);
        }

        /* Chart Container - –°—Ç–∏–ª–∏ –∏–∑ trading.html */
        .chart-wrap {
            width: 100%;
            max-width: 760px;
            aspect-ratio: 16/10;
            border-radius: 12px;
            overflow: hidden;
            background: var(--bg);
            border: 1px solid var(--border);
            position: relative;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
            margin: 0 auto 20px;
        }

        .chart {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
        }

        .chart--hidden {
            display: none;
        }

        /* Timer - –°—Ç–∏–ª–∏ –∏–∑ trading.html */
        .timerBox {
            width: 100%;
            max-width: 760px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            margin: 20px auto;
        }

        .timerText {
            font-variant-numeric: tabular-nums;
            font-size: 18px;
            font-weight: 800;
            letter-spacing: .5px;
        }

        .bar {
            width: 100%;
            height: 10px;
            border-radius: 999px;
            border: 1px solid var(--border);
            background: rgba(255,255,255,.05);
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
        }

        .bar__fill {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 100%;
            background: linear-gradient(90deg, var(--accent2), var(--accent));
            box-shadow: 0 0 12px rgba(123,91,255,.35);
            transition: width .25s linear;
        }

        /* Deal Card - –°—Ç–∏–ª–∏ –∏–∑ trading.html */
        .deal {
            width: 100%;
            max-width: 760px;
            background: linear-gradient(180deg, rgba(25,13,20,.75), rgba(20,12,18,.92));
            border: 1px solid rgba(255,92,122,.35);
            border-radius: 14px;
            padding: 16px;
            display: none;
            animation: .35s ease fadeIn;
            box-shadow: 0 10px 30px rgba(255,92,122,.18);
            margin: 20px auto;
        }

        .deal.win {
            background: linear-gradient(180deg, rgba(17,33,28,.75), rgba(14,26,23,.92));
            border: 1px solid rgba(39,224,161,.35);
            box-shadow: 0 10px 30px rgba(39,224,161,.18);
        }

        .deal .h {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 900;
            letter-spacing: .4px;
        }

        .deal .h .dot {
            width: 10px;
            height: 10px;
            background: var(--bad);
            border-radius: 50%;
        }

        .deal.win .h .dot {
            background: var(--good);
        }

        .rows {
            margin-top: 10px;
            display: grid;
            gap: 8px;
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .r {
            background: rgba(255,255,255,.02);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 10px 12px;
        }

        .r .label {
            font-size: 12px;
            color: var(--muted);
        }

        .r .val {
            font-weight: 800;
            font-size: 16px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(4px); }
            to { opacity: 1; transform: none; }
        }

        .fade-in {
            animation: .3s ease fadeIn;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--muted);
            text-transform: uppercase;
        }

        /* Chart Containers */
        .chart-container {
            width: 100%;
            height: 300px;
            position: relative;
        }

        .chart-card {
            grid-column: 1 / -1;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 1024px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        /* User Management */
        .users-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border);
            transition: background 0.3s ease;
        }

        .user-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .user-details h4 {
            margin-bottom: 5px;
        }

        .user-details p {
            font-size: 0.8rem;
            color: var(--muted);
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        /* ML Management */
        .ml-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .ml-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .ml-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        /* System Controls */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .control-group h3 {
            margin-bottom: 15px;
            color: var(--text);
        }

        .control-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* Functions Grid */
        .functions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .function-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s;
        }

        .function-card:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
        }

        .function-icon {
            font-size: 24px;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .function-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text);
        }

        .function-desc {
            font-size: 12px;
            color: var(--muted);
        }

        /* Logs */
        .log-container {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 16px;
            border: 1px solid var(--border);
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-info {
            color: var(--primary);
        }

        .log-success {
            color: var(--secondary);
        }

        .log-warning {
            color: var(--warning);
        }

        .log-error {
            color: var(--danger);
        }

        /* Search */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 45px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--muted);
        }

        /* Tables */
        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: rgba(255, 255, 255, 0.05);
            color: var(--muted);
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
        }

        td {
            color: var(--text);
            font-size: 14px;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .status-active {
            color: var(--secondary);
            font-weight: 600;
        }

        .status-inactive {
            color: var(--danger);
            font-weight: 600;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--secondary);
        }

        .notification.error {
            background: var(--danger);
        }

        .notification.warning {
            background: var(--warning);
        }

        /* Loading and Error States */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--muted);
            text-align: center;
        }

        .loading-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-left: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: var(--danger);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--dark);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--border);
        }

        .modal h3 {
            margin-bottom: 20px;
            color: var(--text);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--muted);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .header-left, .header-right {
                justify-content: center;
            }
            
            .tabs {
                justify-content: center;
            }
            
            .signal-details-compact,
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Notification System -->
    <div id="notification" class="notification"></div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div id="statusIndicator" class="status-indicator status-offline">
                    <div class="status-dot offline-dot"></div>
                    <span>Bot Offline</span>
                </div>
                <div class="admin-badge">
                    <i class="fas fa-crown"></i> SUPER ADMIN
                </div>
            </div>
            <div class="header-right">
                <button class="btn" onclick="loadAllData()">
                    <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                </button>
                <button class="btn btn-secondary" onclick="switchToUserView()">
                    <i class="fas fa-eye"></i> –í–∏–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                </button>
                <button class="btn btn-danger" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                </button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('overview')">
                <i class="fas fa-tachometer-alt"></i> –û–±–∑–æ—Ä
            </div>
            <div class="tab" onclick="switchTab('users')">
                <i class="fas fa-users"></i> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            </div>
            <div class="tab" onclick="switchTab('signals')">
                <i class="fas fa-chart-line"></i> –°–∏–≥–Ω–∞–ª—ã
            </div>
            <div class="tab" onclick="switchTab('analytics')">
                <i class="fas fa-chart-bar"></i> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
            </div>
            <div class="tab" onclick="switchTab('ml')">
                <i class="fas fa-brain"></i> ML –ú–æ–¥–µ–ª—å
            </div>
            <div class="tab" onclick="switchTab('system')">
                <i class="fas fa-cog"></i> –°–∏—Å—Ç–µ–º–∞
            </div>
        </div>

        <!-- Overview Tab -->
        <div id="overview-tab" class="tab-content active">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-item">
                    <div class="stat-value" id="stat-users">‚Äî</div>
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="stat-accuracy">‚Äî%</div>
                    <div class="stat-label">–¢–æ—á–Ω–æ—Å—Ç—å –±–æ—Ç–∞</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="stat-trades">‚Äî</div>
                    <div class="stat-label">–í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="stat-status">‚Äî</div>
                    <div class="stat-label">–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</div>
                </div>
            </div>

            <div class="dashboard">
                <!-- Signal Card —Å –≥—Ä–∞—Ñ–∏–∫–æ–º –∏ —Ç–∞–π–º–µ—Ä–æ–º -->
                <div class="card signal-card">
                    <h2><i class="fas fa-satellite-dish"></i> Live Signal</h2>
                    
                    <!-- –ì—Ä–∞—Ñ–∏–∫ -->
                    <div class="chart-wrap">
                        <img id="chartImg" class="chart" alt="chart">
                    </div>

                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏–≥–Ω–∞–ª–µ -->
                    <div class="signal-details-compact">
                        <div class="signal-detail-compact">
                            <div class="detail-label">–ü–∞—Ä–∞</div>
                            <div id="pair" class="detail-value">‚Äî</div>
                        </div>
                        <div class="signal-detail-compact">
                            <div class="detail-label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                            <div id="direction" class="detail-value">‚Äî</div>
                        </div>
                        <div class="signal-detail-compact">
                            <div class="detail-label">–í—Ö–æ–¥</div>
                            <div id="entry" class="detail-value">‚Äî</div>
                        </div>
                        <div class="signal-detail-compact">
                            <div class="detail-label">–≠–∫—Å–ø–∏—Ä–∞—Ü–∏—è</div>
                            <div id="expiry" class="detail-value">‚Äî</div>
                        </div>
                    </div>

                    <!-- –¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞ -->
                    <div class="timerBox">
                        <div id="timerText" class="timerText">‚è≥ ‚Äî:‚Äî</div>
                        <div class="bar"><div id="barFill" class="bar__fill" style="width:100%"></div></div>
                    </div>

                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π —Å–¥–µ–ª–∫–∏ -->
                    <div id="dealCard" class="deal">
                        <div class="h"><span class="dot"></span><span id="dealTitle">–°–î–ï–õ–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê</span></div>
                        <div class="rows">
                            <div class="r"><div class="label">–ü–∞—Ä–∞</div><div id="d_pair" class="val">‚Äî</div></div>
                            <div class="r"><div class="label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div><div id="d_dir" class="val">‚Äî</div></div>
                            <div class="r"><div class="label">–í—Ö–æ–¥</div><div id="d_entry" class="val">‚Äî</div></div>
                            <div class="r"><div class="label">–í—ã—Ö–æ–¥</div><div id="d_exit" class="val">‚Äî</div></div>
                            <div class="r" style="grid-column:1/-1"><div class="label">–†–µ–∑—É–ª—å—Ç–∞—Ç</div><div id="d_res" class="val">‚Äî</div></div>
                        </div>
                    </div>
                </div>

                <!-- Functions Grid -->
                <div class="card">
                    <h2><i class="fas fa-cogs"></i> –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                    <div class="functions-grid">
                        <div class="function-card" onclick="switchTab('users')">
                            <div class="function-icon">
                                <i class="fas fa-users-cog"></i>
                            </div>
                            <div class="function-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</div>
                            <div class="function-desc">–ü—Ä–æ—Å–º–æ—Ç—Ä, –∞–∫—Ç–∏–≤–∞—Ü–∏—è, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                        </div>
                        
                        <div class="function-card" onclick="sendAdminCommand('retrain', '–ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è ML –º–æ–¥–µ–ª–∏...')">
                            <div class="function-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div class="function-title">–û–±—É—á–µ–Ω–∏–µ ML –º–æ–¥–µ–ª–∏</div>
                            <div class="function-desc">–ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</div>
                        </div>
                        
                        <div class="function-card" onclick="switchTab('analytics')">
                            <div class="function-icon">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <div class="function-title">–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
                            <div class="function-desc">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–∞—Ä–∞–º –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
                        </div>
                        
                        <div class="function-card" onclick="switchTab('system')">
                            <div class="function-icon">
                                <i class="fas fa-server"></i>
                            </div>
                            <div class="function-title">–°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏</div>
                            <div class="function-desc">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã</div>
                        </div>
                        
                        <div class="function-card" onclick="sendAdminCommand('broadcast', '–§–æ—Ä–º–∞ —Ä–∞—Å—Å—ã–ª–∫–∏...')">
                            <div class="function-icon">
                                <i class="fas fa-bullhorn"></i>
                            </div>
                            <div class="function-title">–†–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                            <div class="function-desc">–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</div>
                        </div>
                        
                        <div class="function-card" onclick="sendAdminCommand('backup', '–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏...')">
                            <div class="function-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="function-title">–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                            <div class="function-desc">–°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Charts -->
                <div class="card chart-card">
                    <h2><i class="fas fa-chart-pie"></i> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                    <div class="charts-grid">
                        <div class="chart-container">
                            <canvas id="winLossChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="pairsChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- System Logs -->
                <div class="card">
                    <h2><i class="fas fa-terminal"></i> –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏</h2>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div></div>
                        <button class="btn btn-secondary" onclick="loadSystemLogs()">
                            <i class="fas fa-sync"></i> –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                    <div class="log-container" id="system-logs">
                        <div class="log-entry log-info">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="users-tab" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-users"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
                
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: 5489888474)" oninput="searchUsers(this.value)">
                </div>

                <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="showAddUserModal()">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    </button>
                    <button class="btn btn-danger" onclick="bulkRemoveUsers()">
                        <i class="fas fa-ban"></i> –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
                    </button>
                </div>

                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="select-all-users"></th>
                                <th>ID</th>
                                <th>–ò–º—è</th>
                                <th>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</th>
                                <th>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                                <th>–¢–æ—á–Ω–æ—Å—Ç—å</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <tr>
                                <td colspan="8" class="loading">
                                    <div class="loading-spinner"></div>
                                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Signals Tab -->
        <div id="signals-tab" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-chart-line"></i> –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div></div>
                    <button class="btn btn-danger" onclick="sendAdminCommand('clearalltrades', '–ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫...')">
                        <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ —Å–¥–µ–ª–∫–∏
                    </button>
                </div>
                <div id="adminSignalsContainer">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-chart-bar"></i> –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –ø–∞—Ä–∞–º</h2>
                <div class="chart-container">
                    <canvas id="pairsAnalyticsChart"></canvas>
                </div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-brain"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ML –º–æ–¥–µ–ª–∏</h2>
                <div class="chart-container">
                    <canvas id="mlAnalyticsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ML Tab -->
        <div id="ml-tab" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-brain"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ML –ú–æ–¥–µ–ª—å—é</h2>
                
                <div class="ml-info">
                    <h3>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥–µ–ª–∏</h3>
                    <div class="ml-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="ml-accuracy">‚Äî%</div>
                            <div class="stat-label">–¢–µ–∫—É—â–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="ml-trades">‚Äî</div>
                            <div class="stat-label">–û–±—É—á–µ–Ω–∏–µ –Ω–∞ —Å–¥–µ–ª–∫–∞—Ö</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="ml-version">v3.2.1</div>
                            <div class="stat-label">–í–µ—Ä—Å–∏—è –º–æ–¥–µ–ª–∏</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="ml-status">‚Äî</div>
                            <div class="stat-label">–°—Ç–∞—Ç—É—Å</div>
                        </div>
                    </div>
                </div>

                <div class="ml-controls">
                    <div class="function-card" onclick="sendAdminCommand('retrain', '–ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è ML –º–æ–¥–µ–ª–∏...')">
                        <div class="function-icon">
                            <i class="fas fa-retweet"></i>
                        </div>
                        <div class="function-title">–ü–µ—Ä–µ–æ–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å</div>
                        <div class="function-desc">–û–±—É—á–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</div>
                    </div>
                    
                    <div class="function-card" onclick="sendAdminCommand('forceml', '–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ ML...')">
                        <div class="function-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <div class="function-title">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–∏—Ç—å ML</div>
                        <div class="function-desc">–ê–∫—Ç–∏–≤–∞—Ü–∏—è ML —Ñ—É–Ω–∫—Ü–∏–π</div>
                    </div>
                    
                    <div class="function-card" onclick="sendAdminCommand('repairml', '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ML...')">
                        <div class="function-icon">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div class="function-title">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ML</div>
                        <div class="function-desc">–†–µ–º–æ–Ω—Ç ML —Ñ–∏—á–µ–π</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Tab -->
        <div id="system-tab" class="tab-content">
            <div class="card">
                <h2><i class="fas fa-cog"></i> –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã</h2>
                
                <div class="controls-grid">
                    <div class="control-group">
                        <h3>–û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h3>
                        <div class="control-buttons">
                            <button class="btn btn-danger" onclick="sendAdminCommand('stop', '–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞...')">
                                <i class="fas fa-power-off"></i> –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
                            </button>
                            <button class="btn btn-warning" onclick="sendAdminCommand('restart', '–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞...')">
                                <i class="fas fa-redo"></i> –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
                            </button>
                            <button class="btn" onclick="sendAdminCommand('checkdata', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö...')">
                                <i class="fas fa-check-circle"></i> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                            </button>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h3>
                        <div class="control-buttons">
                            <button class="btn btn-danger" onclick="sendAdminCommand('clearalltrades', '–û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫...')">
                                <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–¥–µ–ª–∫–∏
                            </button>
                            <button class="btn btn-warning" onclick="sendAdminCommand('restorecounter', '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤...')">
                                <i class="fas fa-undo"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏
                            </button>
                            <button class="btn" onclick="sendAdminCommand('cleartrade', '–û—á–∏—Å—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–¥–µ–ª–∫–∏...')">
                                <i class="fas fa-times"></i> –û—á–∏—Å—Ç–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é —Å–¥–µ–ª–∫—É
                            </button>
                        </div>
                    </div>

                    <div class="control-group">
                        <h3>–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
                        <div class="control-buttons">
                            <button class="btn btn-success" onclick="sendAdminCommand('backup', '–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏...')">
                                <i class="fas fa-database"></i> –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
                            </button>
                            <button class="btn" onclick="sendAdminCommand('restorebackup', '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞...')">
                                <i class="fas fa-history"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-user-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <div class="form-group">
                <label for="userPocketId">Pocket Option ID:</label>
                <input type="text" id="userPocketId" placeholder="–í–≤–µ–¥–∏—Ç–µ Pocket ID">
            </div>
            <div class="form-group">
                <label for="userName">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="text" id="userName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
            </div>
            <div class="form-group">
                <label for="userTelegramId">Telegram ID (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                <input type="text" id="userTelegramId" placeholder="–í–≤–µ–¥–∏—Ç–µ Telegram ID">
            </div>
            <div class="form-group">
                <label for="userRole">–†–æ–ª—å:</label>
                <select id="userRole">
                    <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                    <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-success" onclick="addUser()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const BASE_URL = 'https://nonurban-joella-unvagrantly.ngrok-free.dev';
let appState = {
    isOnline: false,
    charts: {},
    currentTab: 'overview',
    users: [],
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –∏ —Ç–∞–π–º–µ—Ä–∞
    lastSignalTs: 0,
    lastTradeIdShown: null,
    timerInt: null,
    totalMs: 0,
    expiryMs: 0,
};

// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.className = `notification ${type} show`;
    
    setTimeout(() => {
        notification.classList.remove('show');
    }, 4000);
}

// –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
function switchTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));

    document.getElementById(`${tabName}-tab`).classList.add('active');
    document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
    
    appState.currentTab = tabName;
    
    switch(tabName) {
        case 'users':
            loadUsersTable();
            break;
        case 'signals':
            loadAdminSignals();
            break;
        case 'analytics':
            loadAnalyticsCharts();
            break;
        case 'ml':
            loadMLData();
            break;
    }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –∏ —Ç–∞–π–º–µ—Ä–∞ (–∏–∑ trading.html)
const pad = x => String(x).padStart(2,'0');
const fmt = n => (n===null||n===undefined) ? "‚Äî" : (typeof n==="number" ? (Math.abs(n) >= 1 ? n.toFixed(5) : n.toPrecision(6)) : n);

function setChartVisible(v){
    const img = document.getElementById('chartImg');
    if(v) img.classList.remove('chart--hidden'); 
    else img.classList.add('chart--hidden');
}

function setDealVisible(v, isWin=false){
    const card = document.getElementById('dealCard');
    if(v){
        card.style.display = 'block';
        card.classList.add('fade-in');
        isWin ? card.classList.add('win') : card.classList.remove('win');
    }else{
        card.style.display = 'none';
        card.classList.remove('win');
    }
}

function startTimer(createdTs, expiryMinutes){
    clearInterval(appState.timerInt);

    if(!createdTs || !expiryMinutes){
        document.getElementById('timerText').textContent = '‚è≥ ‚Äî:‚Äî';
        document.getElementById('barFill').style.width = '0%';
        return;
    }

    const createdMs = (typeof createdTs === 'number') ? createdTs : new Date(createdTs).getTime();
    const expiryMs  = createdMs + (expiryMinutes * 60 * 1000);
    const totalMs   = Math.max(1, expiryMs - createdMs);

    appState.expiryMs = expiryMs;
    appState.totalMs  = totalMs;

    const tick = () => {
        const now = Date.now();
        const rem = Math.max(0, expiryMs - now);
        const mm = Math.floor(rem/1000/60);
        const ss = Math.floor(rem/1000) % 60;
        document.getElementById('timerText').textContent = `‚è≥ –û—Å—Ç–∞–ª–æ—Å—å: ${pad(mm)}:${pad(ss)}`;

        const pct = Math.max(0, Math.min(100, (rem / totalMs) * 100));
        document.getElementById('barFill').style.width = `${pct}%`;

        if(rem<=0){
            clearInterval(appState.timerInt);
        }
    };

    tick();
    appState.timerInt = setInterval(tick, 250);
}

// –†–µ–Ω–¥–µ—Ä —Å–∏–≥–Ω–∞–ª–∞
function renderSignal(sig, chartBase64){
    setDealVisible(false);
    setChartVisible(true);

    document.getElementById('pair').textContent = sig?.pair ?? '‚Äî';

    const dir = String(sig?.direction||'‚Äî').toUpperCase();
    const dirEl = document.getElementById('direction');
    dirEl.textContent = dir;
    dirEl.className = 'detail-value';
    if(dir==='BUY') dirEl.classList.add('signal-buy');
    if(dir==='SELL') dirEl.classList.add('signal-sell');

    document.getElementById('entry').textContent = fmt(sig?.entry_price ?? sig?.entry);

    const createdTs = sig?.timestamp ?? sig?.created_at ?? Date.now();
    const expMin    = sig?.expiry ?? sig?.expiry_minutes ?? null;
    if(createdTs && expMin){
        const expAt = new Date((typeof createdTs==='number'?createdTs:new Date(createdTs).getTime()) + expMin*60*1000);
        document.getElementById('expiry').textContent = expAt.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        startTimer(createdTs, expMin);
    }else{
        document.getElementById('expiry').textContent = '‚Äî';
        startTimer(null, null);
    }

    if(chartBase64){
        document.getElementById('chartImg').src = chartBase64.startsWith("data:image") 
            ? chartBase64 
            : `data:image/png;base64,${chartBase64}`;
    }
}

function renderCompleted(res){
    const id   = res?.trade_id ?? '‚Äî';
    const pair = res?.pair ?? '‚Äî';
    const dir  = res?.direction ? String(res.direction).toUpperCase() : '‚Äî';
    const entry= res?.entry_price ?? res?.entry ?? '‚Äî';
    const exit = res?.exit_price  ?? res?.exit  ?? '‚Äî';
    const result = (res?.result || '‚Äî').toUpperCase();

    const prefix = (result==='WIN') ? 'üü¢ –°–î–ï–õ–ö–ê #' : 'üî¥ –°–î–ï–õ–ö–ê #';
    document.getElementById('dealTitle').textContent = `${prefix}${id} –ó–ê–í–ï–†–®–ï–ù–ê`;

    document.getElementById('d_pair').textContent  = pair;
    document.getElementById('d_dir').textContent   = dir;
    document.getElementById('d_entry').textContent = fmt(entry);
    document.getElementById('d_exit').textContent  = fmt(exit);
    document.getElementById('d_res').textContent   = result;

    setChartVisible(false);
    setDealVisible(true, result==='WIN');

    clearInterval(appState.timerInt);
    document.getElementById('timerText').textContent = '‚è≥ ‚Äî:‚Äî';
    document.getElementById('barFill').style.width = '0%';
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
async function loadAllData() {
    try {
        console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å:', BASE_URL);
        
        const [systemData, signalData, usersData] = await Promise.allSettled([
            fetch(`${BASE_URL}/api/system_status.json`, {cache: 'no-store'}).then(r => {
                if (!r.ok) throw new Error(`HTTP ${r.status}`);
                return r.json();
            }),
            fetch(`${BASE_URL}/api/latest_full.json`, {cache: 'no-store'}).then(r => {
                if (!r.ok) throw new Error(`HTTP ${r.status}`);
                return r.json();
            }),
            fetch(`${BASE_URL}/pocket_users.json`, {cache: 'no-store'}).then(r => {
                if (!r.ok) throw new Error(`HTTP ${r.status}`);
                return r.json();
            })
        ]);

        console.log('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', { systemData, signalData, usersData });

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
        if (systemData.status === 'fulfilled') {
            await handleSystemData(systemData.value);
        } else {
            console.error('–û—à–∏–±–∫–∞ system_data:', systemData.reason);
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª—ã –∏ –≥—Ä–∞—Ñ–∏–∫–∏
        if (signalData.status === 'fulfilled') {
            await handleSignalData(signalData.value);
        } else {
            console.error('–û—à–∏–±–∫–∞ signal_data:', signalData.reason);
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        if (usersData.status === 'fulfilled') {
            await handleUsersData(usersData.value);
        } else {
            console.error('–û—à–∏–±–∫–∞ users_data:', usersData.reason);
            // –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å
            try {
                const altUsers = await fetch(`${BASE_URL}/api/pocket_users.json`, {cache: 'no-store'}).then(r => r.json());
                await handleUsersData(altUsers);
            } catch (e) {
                console.error('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å —Ç–æ–∂–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', e);
            }
        }

        appState.isOnline = true;
        updateStatusIndicator(true);

    } catch (error) {
        console.error('–û–±—â–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        handleError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
        appState.isOnline = false;
        updateStatusIndicator(false);
    }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º—ã
async function handleSystemData(data) {
    console.log('–î–∞–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã:', data);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    const totalUsers = data.total_users || data.active_users || 0;
    const winRate = data.win_rate || data.accuracy || 0;
    const totalTrades = data.total_trades || 0;
    const botStatus = data.bot_status || data.status || 'unknown';

    document.getElementById('stat-users').textContent = totalUsers;
    document.getElementById('stat-accuracy').textContent = `${winRate}%`;
    document.getElementById('stat-trades').textContent = totalTrades;
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
    let statusText = '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
    let statusLabel = '–°—Ç–∞—Ç—É—Å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω';
    
    if (botStatus === 'running' || botStatus === 'active') {
        statusText = '–†–∞–±–æ—Ç–∞–µ—Ç';
        statusLabel = '–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞';
    } else if (botStatus === 'stopped' || botStatus === 'inactive') {
        statusText = '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
        statusLabel = '–°–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞';
    } else {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–∞–∫ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç—ã
        if (totalUsers > 0) {
            statusText = '–†–∞–±–æ—Ç–∞–µ—Ç';
            statusLabel = `${totalUsers} –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`;
        } else {
            statusText = '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö';
            statusLabel = '–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π';
        }
    }
    
    document.getElementById('stat-status').textContent = statusText;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫—É
    updateAnalyticsCharts(data);
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
async function handleSignalData(data) {
    console.log('–î–∞–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª–æ–≤:', data);
    
    const sig = data?.signal || null;
    const res = data?.result || null;
    const chartB64 = data?.chart_base64 || null;

    let showSignal = false;
    if(sig && sig.pair){
        const created = sig?.timestamp ?? sig?.created_at ?? null;
        const expMin  = sig?.expiry ?? sig?.expiry_minutes ?? null;
        if(created && expMin){
            const createdMs = (typeof created==='number') ? created : new Date(created).getTime();
            const expMs = createdMs + expMin*60*1000;
            showSignal = expMs > Date.now();
        } else {
            // –ï—Å–ª–∏ –Ω–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ —ç–∫—Å–ø–∏—Ä–∞—Ü–∏–∏, –Ω–æ –µ—Å—Ç—å —Å–∏–≥–Ω–∞–ª - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ
            showSignal = true;
        }
    }

    if(showSignal){
        const stamp = sig?.timestamp ? (typeof sig.timestamp==='number' ? sig.timestamp : new Date(sig.timestamp).getTime())
                                     : (sig?.created_at ? new Date(sig.created_at).getTime() : Date.now());
        if (stamp !== appState.lastSignalTs){
            appState.lastSignalTs = stamp;
            renderSignal(sig, chartB64);
        }
    }else if(res && res.trade_id){
        if(res.trade_id !== appState.lastTradeIdShown){
            appState.lastTradeIdShown = res.trade_id;
            renderCompleted(res);
        }
    } else {
        // –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ –∏ –Ω–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π —Å–¥–µ–ª–∫–∏
        setDealVisible(false);
        setChartVisible(false);
        clearInterval(appState.timerInt);
        document.getElementById('timerText').textContent = '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞';
        document.getElementById('barFill').style.width = '0%';
    }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
async function handleUsersData(data) {
    console.log('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', data);
    
    if (!data) {
        console.log('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
        return;
    }

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö
    let users = [];
    
    if (Array.isArray(data)) {
        users = data;
    } else if (data.users && Array.isArray(data.users)) {
        users = data.users;
    } else if (typeof data === 'object') {
        // –§–æ—Ä–º–∞—Ç { "user_id": { user_data }, ... }
        users = Object.entries(data).map(([id, userData]) => ({
            id: id,
            ...userData
        }));
    }

    appState.users = users;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    const activeUsers = users.filter(user => 
        user.status === 'active' || user.is_active || user.last_activity
    ).length;

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
    document.getElementById('stat-users').textContent = activeUsers || users.length;
    
    // –ï—Å–ª–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É
    if (appState.currentTab === 'users') {
        renderUsersTable();
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
function updateStatusIndicator(isOnline) {
    const indicator = document.getElementById('statusIndicator');
    if (isOnline) {
        indicator.className = 'status-indicator status-online';
        indicator.innerHTML = '<div class="status-dot online-dot"></div><span>Bot Online</span>';
    } else {
        indicator.className = 'status-indicator status-offline';
        indicator.innerHTML = '<div class="status-dot offline-dot"></div><span>Bot Offline</span>';
    }
}

function updateAnalyticsCharts(data) {
    // Win/Loss Chart
    const winLossCtx = document.getElementById('winLossChart').getContext('2d');
    if (appState.charts.winLoss) {
        appState.charts.winLoss.destroy();
    }
    
    const winRate = data.win_rate || 50;
    appState.charts.winLoss = new Chart(winLossCtx, {
        type: 'doughnut',
        data: {
            labels: ['–í—ã–∏–≥—Ä—ã—à–∏', '–ü—Ä–æ–∏–≥—Ä—ã—à–∏'],
            datasets: [{
                data: [winRate, 100 - winRate],
                backgroundColor: ['#10b981', '#ef4444'],
                borderWidth: 2,
                borderColor: '#1f2937'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#f3f4f6',
                        font: { size: 12 }
                    }
                }
            }
        }
    });

    // Pairs Chart
    const pairsCtx = document.getElementById('pairsChart').getContext('2d');
    if (appState.charts.pairs) {
        appState.charts.pairs.destroy();
    }
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
    const pairsData = data.pairs_performance || {
        'EURUSD': 25,
        'GBPUSD': 18, 
        'USDJPY': 15,
        'AUDUSD': 12,
        'USDCAD': 10,
        'Others': 20
    };

    appState.charts.pairs = new Chart(pairsCtx, {
        type: 'pie',
        data: {
            labels: Object.keys(pairsData),
            datasets: [{
                data: Object.values(pairsData),
                backgroundColor: [
                    '#6366f1', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#6b7280'
                ],
                borderWidth: 2,
                borderColor: '#1f2937'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#f3f4f6',
                        font: { size: 11 }
                    }
                }
            }
        }
    });
}

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
async function loadUsersTable() {
    try {
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
        if (appState.users.length > 0) {
            renderUsersTable();
            return;
        }

        // –ò–Ω–∞—á–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–Ω–æ–≤–æ
        const response = await fetch(`${BASE_URL}/pocket_users.json`, {cache: 'no-store'});
        if (!response.ok) throw new Error('Failed to load users');
        
        const data = await response.json();
        await handleUsersData(data);

    } catch (error) {
        console.error('Error loading users:', error);
        document.getElementById('usersTable').innerHTML = `
            <tr>
                <td colspan="8" class="error">
                    <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${error.message}</p>
                    <button class="btn btn-secondary" onclick="loadUsersTable()" style="margin-top: 10px;">
                        –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                    </button>
                </td>
            </tr>
        `;
    }
}

function renderUsersTable() {
    const container = document.getElementById('usersTable');
    
    if (!appState.users || appState.users.length === 0) {
        container.innerHTML = `
            <tr>
                <td colspan="8" class="loading">
                    <i class="fas fa-users"></i>
                    <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                </td>
            </tr>
        `;
        return;
    }

    let usersHTML = '';
    
    appState.users.forEach(user => {
        const isActive = user.status === 'active' || user.is_active || user.last_activity;
        const lastActivity = user.last_activity ? 
            new Date(user.last_activity).toLocaleDateString('ru-RU') : 
            '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        
        usersHTML += `
            <tr>
                <td><input type="checkbox" data-user-id="${user.id}"></td>
                <td>${user.id || '‚Äî'}</td>
                <td>${user.name || user.username || '‚Äî'}</td>
                <td>${user.registered_at ? new Date(user.registered_at).toLocaleDateString('ru-RU') : '‚Äî'}</td>
                <td>${lastActivity}</td>
                <td>${user.accuracy || user.win_rate || 0}%</td>
                <td class="${isActive ? 'status-active' : 'status-inactive'}">
                    ${isActive ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                </td>
                <td>
                    <button class="btn btn-small" onclick="manageUser('${user.id}')">
                        <i class="fas fa-cog"></i>
                    </button>
                </td>
            </tr>
        `;
    });



        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function showAddUserModal() {
            document.getElementById('addUserModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('addUserModal').style.display = 'none';
        }

        async function addUser() {
            const pocketId = document.getElementById('userPocketId').value;
            const name = document.getElementById('userName').value;
            const telegramId = document.getElementById('userTelegramId').value;
            const role = document.getElementById('userRole').value;

            if (!pocketId || !name) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                return;
            }

            await sendAdminCommand(`add_user ${pocketId}`, `–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${name}...`);
            closeModal();
            
            document.getElementById('userPocketId').value = '';
            document.getElementById('userName').value = '';
            document.getElementById('userTelegramId').value = '';
        }

        function bulkRemoveUsers() {
            const selectedUsers = Array.from(document.querySelectorAll('#usersTable input[type="checkbox"]:checked'))
                .map(checkbox => checkbox.closest('tr').querySelector('td:nth-child(2)').textContent);
            
            if (selectedUsers.length === 0) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'warning');
                return;
            }
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å ${selectedUsers.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Å–∏—Å—Ç–µ–º—ã?`)) {
                sendAdminCommand(`remove_users ${selectedUsers.join(',')}`, `–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...`);
            }
        }

        // –°–∏–≥–Ω–∞–ª—ã
        async function loadAdminSignals() {
            const container = document.getElementById('adminSignalsContainer');
            
            try {
                const response = await fetch(`${BASE_URL}/api/last_signal.json`);
                const signal = await response.json();
                
                if (signal.error || !signal.pair) {
                    container.innerHTML = '<div class="error">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤</div>';
                    return;
                }
                
                container.innerHTML = `
                    <div class="card signal-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3>${signal.pair} - ${signal.direction}</h3>
                            <span class="status-active">–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${signal.confidence}/10</span>
                        </div>
                        <div class="signal-details-compact">
                            <div class="signal-detail-compact">
                                <div class="detail-label">–ü–∞—Ä–∞</div>
                                <div class="detail-value">${signal.pair}</div>
                            </div>
                            <div class="signal-detail-compact">
                                <div class="detail-label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                                <div class="detail-value" style="color: ${signal.direction === 'BUY' ? 'var(--good)' : 'var(--bad)'};">${signal.direction}</div>
                            </div>
                            <div class="signal-detail-compact">
                                <div class="detail-label">–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞</div>
                                <div class="detail-value">${signal.entry_price || '‚Äî'}</div>
                            </div>
                            <div class="signal-detail-compact">
                                <div class="detail-label">–≠–∫—Å–ø–∏—Ä–∞—Ü–∏—è</div>
                                <div class="detail-value">${signal.expiry || '‚Äî'} –º–∏–Ω</div>
                            </div>
                        </div>
                        <button class="btn btn-danger" style="width: 100%; margin-top: 15px;" onclick="sendAdminCommand('cleartrade', '–û—á–∏—Å—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–¥–µ–ª–∫–∏...')">
                            <i class="fas fa-times"></i> –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–∫—Ä—ã—Ç—å —Å–¥–µ–ª–∫—É
                        </button>
                    </div>
                `;
                
            } catch (error) {
                container.innerHTML = `<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤: ${error.message}</div>`;
            }
        }

        // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
        function loadAnalyticsCharts() {
            const pairsCtx = document.getElementById('pairsAnalyticsChart').getContext('2d');
            new Chart(pairsCtx, {
                type: 'bar',
                data: {
                    labels: ['EURUSD', 'GBPUSD', 'USDJPY', 'AUDCHF', 'GBPCHF'],
                    datasets: [{
                        label: '–¢–æ—á–Ω–æ—Å—Ç—å %',
                        data: [76.6, 73.5, 78.2, 71.1, 68.9],
                        backgroundColor: [
                            'rgba(99, 102, 241, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(139, 92, 246, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            const mlCtx = document.getElementById('mlAnalyticsChart').getContext('2d');
            new Chart(mlCtx, {
                type: 'line',
                data: {
                    labels: ['–Ø–Ω–≤ 10', '–Ø–Ω–≤ 11', '–Ø–Ω–≤ 12', '–Ø–Ω–≤ 13', '–Ø–Ω–≤ 14', '–Ø–Ω–≤ 15'],
                    datasets: [{
                        label: '–¢–æ—á–Ω–æ—Å—Ç—å ML %',
                        data: [72.1, 74.3, 75.8, 76.2, 77.5, 78.3],
                        borderColor: 'rgba(16, 185, 129, 0.8)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // ML –¥–∞–Ω–Ω—ã–µ
        function loadMLData() {
            document.getElementById('ml-accuracy').textContent = '78.3%';
            document.getElementById('ml-trades').textContent = '1,247';
            document.getElementById('ml-status').textContent = '–ê–∫—Ç–∏–≤–Ω–∞';
        }

        // –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
        async function loadSystemLogs() {
            const container = document.getElementById('system-logs');
            container.innerHTML = '<div class="log-entry log-info">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...</div>';
            
            setTimeout(() => {
                container.innerHTML = `
                    <div class="log-entry log-info">[INFO] ${new Date().toLocaleString()} - –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ</div>
                    <div class="log-entry log-success">[SUCCESS] ${new Date().toLocaleString()} - –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã</div>
                    <div class="log-entry log-warning">[WARNING] ${new Date().toLocaleString()} - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MT5</div>
                    <div class="log-entry log-info">[INFO] ${new Date().toLocaleString()} - –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 15</div>
                `;
            }, 1000);
        }

        // –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∞
        async function sendAdminCommand(command, message) {
            showNotification(message, 'warning');
            
            try {
                await new Promise(resolve => setTimeout(resolve, 2000));
                showNotification(`–ö–æ–º–∞–Ω–¥–∞ "${command}" –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ`, 'success');
                loadAllData();
                
            } catch (error) {
                showNotification(`–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã: ${error.message}`, 'error');
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function searchUsers(query) {
            if (query.length >= 3) {
                console.log(`–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${query}`);
            }
        }

        function manageUser(userId) {
            alert(`–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ${userId}`);
        }

        function switchToUserView() {
            window.open('/trading.html', '_blank');
        }

        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                showNotification('–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã...', 'info');
                setTimeout(() => {
                    window.location.href = '/login.html';
                }, 1000);
            }
        }

        function showLoadingState() {
            // –£–∂–µ –µ—Å—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        }

        function handleError(message) {
            showNotification(message, 'error');
            updateStatusIndicator(false);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function init() {
    loadAllData();
    setInterval(loadAllData, 5000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    
    window.addEventListener('click', (e) => {
        if (e.target === document.getElementById('addUserModal')) {
            closeModal();
        }
    });
}

document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
