<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>ASPIRE TRADE ‚Äî Live Signals</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="theme-color" content="#0b0f19" />
  <style>
    :root{
      --bg:#0b0f19;
      --card:#111629;
      --muted:#8d95af;
      --text:#e9ecf5;
      --good:#27e0a1;
      --bad:#ff5c7a;
      --warn:#ffd166;
      --accent:#5aa6ff;
      --accent-2:#7b5bff;
      --border:rgba(255,255,255,0.06);
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:radial-gradient(1200px 600px at 50% -10%, rgba(90,166,255,.08), transparent 60%) , var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";}

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    .wrap{
      min-height:100dvh;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:18px 14px 24px;
      gap:14px;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */
    .head{
      width:100%;
      max-width:900px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .brand{
      display:flex;align-items:center;gap:10px;
      font-weight:700;letter-spacing:.5px
    }
    .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:0 0 18px rgba(122,139,255,.6)}
    .brand span{opacity:.9}
    .status{
      font-size:12px;color:var(--muted);
      padding:4px 8px;border:1px solid var(--border);border-radius:999px;
      backdrop-filter: blur(6px);
    }

    /* –ì–ª–∞–≤–Ω–∞—è —Å–µ—Ç–∫–∞: —Ü–µ–Ω—Ç—Ä ‚Äî –±–æ–ª—å—à–æ–π –±–ª–æ–∫; –±–æ–∫–æ–≤—ã–µ ‚Äî –∏–Ω—Ñ–æ –∫–∞—Ä—Ç–æ—á–∫–∏ (–º–æ–±–∏–ª—å–Ω—ã–µ ‚Äî —Å–Ω–∏–∑—É) */
    .grid{
      width:100%;
      max-width:900px;
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }
    @media (min-width: 860px){
      .grid{
        grid-template-columns: 1.15fr .85fr;
        align-items:start;
      }
    }

    /* –ì–ª–∞–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ (–≥—Ä–∞—Ñ–∏–∫ + —Å–∏–≥–Ω–∞–ª + —Ç–∞–π–º–µ—Ä) */
    .card{
      background:linear-gradient(180deg, rgba(20,26,48,.68), rgba(15,19,34,.85));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .card__inner{
      padding:14px;
    }
    .center-block{
      display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:12px;
    }
    .title{
      font-size:18px;font-weight:700; letter-spacing:.3px;
      display:flex;gap:8px;align-items:center
    }
    .badge{
      font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid var(--border); color:var(--muted)
    }

    /* –ì—Ä–∞—Ñ–∏–∫ */
    .chart-wrap{
      width:100%;
      max-width:760px;
      aspect-ratio: 16/10;
      border-radius:12px;
      overflow:hidden;
      background:#0b0f19;
      border:1px solid var(--border);
      position:relative;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
    }
    .chart{
      width:100%;height:100%;display:block;object-fit:cover
    }
    .chart--hidden{display:none}

    /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –∞–∫—Ç–∏–≤–Ω–æ–º—É —Å–∏–≥–Ω–∞–ª—É */
    .signal{
      width:100%;
      display:grid; gap:8px;
      grid-template-columns: repeat(2, minmax(0,1fr));
    }
    .signal .item{
      background: rgba(255,255,255,.02);
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px 12px;
      display:flex;flex-direction:column;gap:4px
    }
    .label{font-size:12px;color:var(--muted)}
    .val{font-size:16px;font-weight:700}
    .val.buy{color:var(--good)}
    .val.sell{color:var(--bad)}
    .val.em{color:var(--accent)}

    /* –¢–∞–π–º–µ—Ä */
    .timer{
      margin-top:4px;
      font-variant-numeric: tabular-nums;
      font-size:20px;font-weight:800;letter-spacing:.5px
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Å–¥–µ–ª–∫–∏ */
    .deal{
      width:100%;
      max-width:760px;
      background:linear-gradient(180deg, rgba(25,13,20,.75), rgba(20,12,18,.9));
      border:1px solid rgba(255,92,122,.35);
      border-radius:14px;
      padding:16px;
      display:none;
      animation:.35s ease fadeIn;
      box-shadow:0 10px 30px rgba(255,92,122,.18);
    }
    .deal.win{
      background:linear-gradient(180deg, rgba(17,33,28,.75), rgba(14,26,23,.9));
      border:1px solid rgba(39,224,161,.35);
      box-shadow:0 10px 30px rgba(39,224,161,.18);
    }
    .deal .h{
      display:flex;align-items:center;gap:8px;
      font-weight:800;letter-spacing:.4px
    }
    .deal .h .dot{width:10px;height:10px;background:var(--bad)}
    .deal.win .h .dot{background:var(--good)}
    .deal .rows{
      margin-top:10px;display:grid;gap:8px;
      grid-template-columns: repeat(2, minmax(0,1fr));
    }
    .deal .rows .r{
      background: rgba(255,255,255,.02);
      border:1px solid var(--border);
      border-radius:10px;padding:10px 12px
    }
    .deal .rows .r .label{font-size:12px;color:var(--muted)}
    .deal .rows .r .val{font-weight:700;font-size:16px}

    /* –ë–æ–∫–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º–∏ –∏–Ω—Ñ–æ-–∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ */
    .side{
      display:grid;gap:12px
    }
    .mini{
      background:linear-gradient(180deg, rgba(20,26,48,.65), rgba(15,19,34,.82));
      border:1px solid var(--border);
      border-radius:14px;padding:12px;
    }
    .mini h4{margin:0 0 6px 0;font-size:14px;opacity:.9}
    .mini .kv{display:flex;justify-content:space-between; font-size:13px;color:var(--muted)}
    .mini .kv .v{color:var(--text);font-weight:700}

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
    @keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}
    .fade-in{animation:.3s ease fadeIn}
    .hide{display:none!important}

    /* –ú–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ */
    @media (max-width: 480px){
      .title{font-size:16px}
      .signal{grid-template-columns: 1fr 1fr}
      .deal .rows{grid-template-columns: 1fr 1fr}
    }
  </style>
</head>
<body>
  <!-- CONFIG -->
  <script>
    const CONFIG = {
      apiBase: "https://nonurban-joella-unvagrantly.ngrok-free.dev",
      endpoints: {
        latest:   "/api/latest_full.json",
        system:   "/api/system_status.json",
        chart:    "/api/chart.png",           // PNG –≥—Ä–∞—Ñ–∏–∫–∞
        lastSig:  "/api/last_signal.json",    // –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
        lastRes:  "/api/last_result.json"     // –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–∞—è —Å–¥–µ–ª–∫–∞
      },
      refreshMs: 5000,   // –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫
      chartBust: true    // –¥–æ–±–∞–≤–ª—è—Ç—å ?ts= –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏
    };
  </script>

  <div class="wrap">
    <!-- –®–∞–ø–∫–∞ -->
    <div class="head">
      <div class="brand"><span class="dot"></span><span>ASPIRE TRADE</span></div>
      <div id="sysStatus" class="status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è‚Ä¶</div>
    </div>

    <div class="grid">
      <!-- –¶–µ–Ω—Ç—Ä: –≥—Ä–∞—Ñ–∏–∫ + —Å–∏–≥–Ω–∞–ª + —Ç–∞–π–º–µ—Ä / –ª–∏–±–æ –∫–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è -->
      <div class="card">
        <div class="card__inner center-block" id="centerBlock">

          <div class="title"><span>–¢–ï–ö–£–©–ò–ô –°–ò–ì–ù–ê–õ</span> <span id="sigSource" class="badge">‚Äî</span></div>

          <!-- –ì—Ä–∞—Ñ–∏–∫ -->
          <div class="chart-wrap">
            <img id="chartImg" class="chart" alt="chart">
          </div>

          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Å–∏–≥–Ω–∞–ª—É -->
          <div class="signal">
            <div class="item">
              <div class="label">–ü–∞—Ä–∞</div>
              <div id="pair" class="val em">‚Äî</div>
            </div>
            <div class="item">
              <div class="label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
              <div id="direction" class="val">‚Äî</div>
            </div>
            <div class="item">
              <div class="label">–í—Ö–æ–¥</div>
              <div id="entry" class="val">‚Äî</div>
            </div>
            <div class="item">
              <div class="label">–≠–∫—Å–ø–∏—Ä–∞—Ü–∏—è</div>
              <div id="expiry" class="val">‚Äî</div>
            </div>
          </div>

          <!-- –¢–∞–π–º–µ—Ä -->
          <div class="timer" id="countdown">‚è≥ ‚Äî:‚Äî</div>

          <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Å–¥–µ–ª–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç–∞) -->
          <div id="dealCard" class="deal">
            <div class="h"><span class="dot"></span><span id="dealTitle">–°–î–ï–õ–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê</span></div>
            <div class="rows">
              <div class="r"><div class="label">–ü–∞—Ä–∞</div><div id="d_pair" class="val">‚Äî</div></div>
              <div class="r"><div class="label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div><div id="d_dir" class="val">‚Äî</div></div>
              <div class="r"><div class="label">–í—Ö–æ–¥</div><div id="d_entry" class="val">‚Äî</div></div>
              <div class="r"><div class="label">–í—ã—Ö–æ–¥</div><div id="d_exit" class="val">‚Äî</div></div>
              <div class="r" style="grid-column:1 / -1"><div class="label">–†–µ–∑—É–ª—å—Ç–∞—Ç</div><div id="d_res" class="val">‚Äî</div></div>
            </div>
          </div>

        </div>
      </div>

      <!-- –ë–æ–∫–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∏–Ω—Ñ–æ –±–ª–æ–∫–∏ -->
      <div class="side">
        <div class="mini">
          <h4>–°–∏—Å—Ç–µ–º–∞</h4>
          <div class="kv"><span>MT5</span><span id="mt5" class="v">‚Äî</span></div>
          <div class="kv"><span>ML</span><span id="ml" class="v">‚Äî</span></div>
          <div class="kv"><span>–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span><span id="users" class="v">‚Äî</span></div>
        </div>
        <div class="mini">
          <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
          <div class="kv"><span>–°–¥–µ–ª–æ–∫</span><span id="total" class="v">‚Äî</span></div>
          <div class="kv"><span>–ü–æ–±–µ–¥</span><span id="wins" class="v">‚Äî</span></div>
          <div class="kv"><span>Win Rate</span><span id="winrate" class="v">‚Äî</span></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --------- –£—Ç–∏–ª–∏—Ç—ã
    const qs = s => document.querySelector(s);
    const fmt = n => (n===null||n===undefined) ? "‚Äî" : (typeof n==="number" ? (Math.abs(n) >= 1 ? n.toFixed(5) : n.toPrecision(6)) : n);
    const pad = x => String(x).padStart(2,'0');

    let countdownTimer = null;
    let lastTradeIdShown = null;
    let lastSignalTs = 0;

    function setSystemStatus(text){
      qs('#sysStatus').textContent = text;
    }

    function setChartVisible(v){
      const img = qs('#chartImg');
      if(v){
        img.classList.remove('chart--hidden');
      }else{
        img.classList.add('chart--hidden');
      }
    }

    function setDealVisible(v, win=false){
      const card = qs('#dealCard');
      if(v){
        card.classList.remove('hide');
        card.classList.add('fade-in');
        if(win){ card.classList.add('win'); } else { card.classList.remove('win'); }
      }else{
        card.classList.add('hide');
        card.classList.remove('win');
      }
    }

    function startCountdown(expiryIso){
      clearInterval(countdownTimer);
      const el = qs('#countdown');
      if(!expiryIso){ el.textContent = '‚è≥ ‚Äî:‚Äî'; return; }
      const target = new Date(expiryIso).getTime();
      countdownTimer = setInterval(()=>{
        const now = Date.now();
        let diff = Math.max(0, target - now);
        const sec = Math.floor(diff/1000);
        const m = Math.floor(sec/60);
        const s = sec % 60;
        el.textContent = `‚è≥ –û—Å—Ç–∞–ª–æ—Å—å: ${pad(m)}:${pad(s)}`;
        if(diff<=0){
          clearInterval(countdownTimer);
        }
      }, 250);
    }

    function cacheBust(url){
      return CONFIG.chartBust ? `${url}?ts=${Date.now()}` : url;
    }

    // --------- –†–µ–Ω–¥–µ—Ä—ã
    function renderSystem(sys){
      try{
        const mt5 = sys?.mt5===true || sys?.mt5==="OK";
        const ml  = !!sys?.ml_loaded || (sys?.ml_accuracy>0);
        qs('#mt5').textContent = mt5 ? 'OK' : '‚Äî';
        qs('#ml').textContent  = ml ? 'OK' : '‚Äî';
        qs('#users').textContent = sys?.active_users ?? sys?.users_count ?? '‚Äî';
      }catch(e){}
    }

    function renderStats(stats){
      try{
        qs('#total').textContent   = stats?.total ?? '‚Äî';
        qs('#wins').textContent    = stats?.wins ?? '‚Äî';
        const wr = stats?.win_rate ?? stats?.winrate;
        qs('#winrate').textContent = (wr!=null) ? `${wr}%` : '‚Äî';
      }catch(e){}
    }

    function renderActiveSignal(sig){
      // –æ–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç: { trade_id?, pair, direction, entry, expiry_at?, expiry_minutes?, created_at?, source, confidence }
      qs('#sigSource').textContent = sig?.source ?? '‚Äî';
      qs('#pair').textContent      = sig?.pair ?? '‚Äî';
      const dir = String(sig?.direction||'‚Äî').toUpperCase();
      const dirEl = qs('#direction');
      dirEl.textContent = dir;
      dirEl.classList.remove('buy','sell');
      if(dir==='BUY') dirEl.classList.add('buy');
      if(dir==='SELL') dirEl.classList.add('sell');
      qs('#entry').textContent     = fmt(sig?.entry);

      // –≠–∫—Å–ø–∏—Ä–∞—Ü–∏—è
      let expiryLabel = '‚Äî';
      let expiryIso = sig?.expiry_at;
      const created = sig?.created_at ? new Date(sig.created_at).getTime() : null;
      if(!expiryIso && sig?.expiry_minutes && created){
        expiryIso = new Date(created + sig.expiry_minutes*60*1000).toISOString();
      }
      if(expiryIso){
        const d = new Date(expiryIso);
        expiryLabel = d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
      }
      qs('#expiry').textContent = expiryLabel;

      // –ü–æ–∫–∞–∑–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ –∏ —Å–ø—Ä—è—Ç–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É —Å–¥–µ–ª–∫–∏
      setDealVisible(false);
      setChartVisible(true);

      // –û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É –≥—Ä–∞—Ñ–∏–∫–∞
      qs('#chartImg').src = cacheBust(`${CONFIG.apiBase}${CONFIG.endpoints.chart}`);

      // –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–∞–π–º–µ—Ä
      startCountdown(expiryIso);
    }

    function renderCompletedTrade(res){
      // —Ñ–æ—Ä–º–∞—Ç: { trade_id, pair, direction, entry_price?, exit_price?, result, completed_at }
      const id = res?.trade_id ?? '‚Äî';
      const pair = res?.pair ?? '‚Äî';
      const dir = res?.direction ? String(res.direction).toUpperCase() : '‚Äî';
      const entry = res?.entry_price ?? res?.entry ?? '‚Äî';
      const exit =  res?.exit_price ?? res?.exit ?? '‚Äî';
      const result = (res?.result||'‚Äî').toUpperCase();

      lastTradeIdShown = res?.trade_id || null;

      // –ó–∞–≥–æ–ª–æ–≤–æ–∫: üî¥/üü¢ –°–î–ï–õ–ö–ê #ID –ó–ê–í–ï–†–®–ï–ù–ê
      const h = (result==='WIN') ? 'üü¢ –°–î–ï–õ–ö–ê #' : 'üî¥ –°–î–ï–õ–ö–ê #';
      qs('#dealTitle').textContent = `${h}${id} –ó–ê–í–ï–†–®–ï–ù–ê`;

      qs('#d_pair').textContent  = pair;
      qs('#d_dir').textContent   = dir;
      qs('#d_entry').textContent = fmt(entry);
      qs('#d_exit').textContent  = fmt(exit);
      qs('#d_res').textContent   = result;

      // –°–∫—Ä—ã—Ç—å –≥—Ä–∞—Ñ–∏–∫ –∏ –ø–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É —Å–¥–µ–ª–∫–∏ (–±–µ–∑ –¥–µ–Ω–µ–≥, –∫–∞–∫ –ø—Ä–æ—Å–∏–ª)
      setChartVisible(false);
      setDealVisible(true, result==='WIN');

      // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä
      clearInterval(countdownTimer);
      qs('#countdown').textContent = '‚è≥ ‚Äî:‚Äî';
    }

    // --------- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    async function loadLatest(){
      try{
        const latestUrl = `${CONFIG.apiBase}${CONFIG.endpoints.latest}`;
        const r = await fetch(latestUrl, {cache:'no-store'});
        if(!r.ok) throw new Error('bad latest_full');
        const data = await r.json();

        // —Å–∏—Å—Ç–µ–º–Ω–∞—è —á–∞—Å—Ç—å
        if(data?.system) renderSystem(data.system);
        else {
          // fallback ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
          fetch(`${CONFIG.apiBase}${CONFIG.endpoints.system}`).then(r=>r.json()).then(renderSystem).catch(()=>{});
        }
        if(data?.stats) renderStats(data.stats);

        // –ª–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const sig = data?.signal;
        const res = data?.result;

        // —Ä–µ—à–µ–Ω–∏–µ: –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π —Å–∏–≥–Ω–∞–ª (expiry –≤ –±—É–¥—É—â–µ–º) ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ.
        // –µ—Å–ª–∏ —Å–∏–≥–Ω–∞–ª–∞ –Ω–µ—Ç –∏–ª–∏ –æ–Ω –∏—Å—Ç—ë–∫ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é —Å–¥–µ–ª–∫—É (–µ—Å–ª–∏ –µ—Å—Ç—å).
        let showSignal = false;

        if(sig){
          let expIso = sig.expiry_at;
          const created = sig?.created_at ? new Date(sig.created_at).getTime() : null;
          if(!expIso && sig?.expiry_minutes && created){
            expIso = new Date(created + sig.expiry_minutes*60*1000).toISOString();
          }
          if(expIso){
            const expMs = new Date(expIso).getTime();
            showSignal = expMs > Date.now();
          }
        }

        if(showSignal){
          // –µ—Å–ª–∏ –ø—Ä–∏—à—ë–ª –Ω–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª ‚Äî —Å—Ä–∞–∑—É –æ–±–Ω–æ–≤–∏–º
          const sigStamp = new Date(sig?.created_at || Date.now()).getTime();
          if(sigStamp !== lastSignalTs){
            lastSignalTs = sigStamp;
            renderActiveSignal(sig);
          }else{
            // –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏–º —Ç–∞–π–º–µ—Ä/–∫–∞—Ä—Ç–∏–Ω–∫—É —Ä–µ–∂–µ
            startCountdown(sig?.expiry_at);
          }
        }else if(res){
          // –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –ø–æ–∫–∞–∂–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
          if(res.trade_id !== lastTradeIdShown){
            renderCompletedTrade(res);
          }
        }else{
          // –Ω–µ—Ç –Ω–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ, –Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ‚Äî –ø—Ä–æ—Å—Ç–æ –∂–¥—ë–º
          setSystemStatus('–û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞‚Ä¶');
        }

        // —Å—Ç–∞—Ç—É—Å –≤ —à–∞–ø–∫–µ
        const acc = data?.system?.ml_accuracy;
        if(acc!=null){
          setSystemStatus(`ML: ${acc}% ‚Ä¢ OK`);
        }else{
          setSystemStatus('–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞');
        }
      }catch(err){
        setSystemStatus('–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        console.error(err);
      }
    }

    // —Å—Ç–∞—Ä—Ç + –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    window.addEventListener('load', ()=>{
      loadLatest();
      setInterval(loadLatest, CONFIG.refreshMs);
    });
  </script>
</body>
</html>
